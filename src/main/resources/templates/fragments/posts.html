<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Posts</title>
    <!-- Bootstrap and FontAwesome -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .post-detail img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .btn-custom {
            margin-right: 10px;
        }
        .comment {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        .comment h5 {
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .align-right {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        .align-center {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div th:replace="/fragments/header :: header"></div>

<div class="container mt-5">
    <!-- Section for the list of posts -->
    <div class="posts_wrapper" th:if="${posts != null}">
        <h1 class="mb-4">Posts</h1>
        <div class="post mb-5" th:each="post : ${posts}">
            <h2 class="h3">
                <a th:href="@{'/posts/' + ${post.id}}" th:text="${post.title}" class="text-dark"></a>
            </h2>
            
        </div>
    </div>

    <!-- Section for the detailed view of a specific post -->
    <div class="post-detail" th:if="${post != null}">
        <h2 class="h3 mb-4" th:text="${post.title}">Title</h2>
        
        <div class="img mb-4">
            <img  alt="Post Image" class="img-fluid rounded">
        </div> 
        <p th:text="${#strings.replace(post.content, '<[^>]*>', '')}" class="text-muted">Body text</p>

        <div class="align-right" sec:authorize="isAuthenticated()">
            <a th:href="@{'/posts/' + ${post.id} + '/edit'}" class="btn btn-sm btn-outline-primary btn-custom">
                <i class="fas fa-edit"></i> Edit
            </a>
            <form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post" 
                  onsubmit="return confirm('Are you sure you want to delete this post?');" class="d-inline">
                <button class="btn btn-sm btn-outline-danger" type="submit">
                    <i class="fas fa-trash-alt"></i> Delete
                </button>
            </form>
        </div>

        <div class="comments mt-5">
            <h2 class="h4 mb-4">Comments</h2>
            <div class="comment" th:each="comment : ${post.comments}">
                <h5 th:text="'Commented by ' + ${comment.user.username}"></h5>
                <p th:utext="${comment.content}" class="text-muted"></p>
            </div>
        </div>

        <div class="align-center">
            <a th:href="@{'/posts/comment/{id}'(id=${post.id})}">
                <button class="btn btn-success btn-sm" type="button"><i class="fas fa-comment"></i> Comment on Post</button>
            </a>
        </div>
    </div>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script type="text/javascript" th:src="@{/richtext/jquery.richtext.min.js}"></script>

</body>
</html>
